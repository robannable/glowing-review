<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DaylightLab - Daylight Analysis Tool</title>
  <link rel="stylesheet" href="/src/styles.css">
</head>
<body>
  <div id="app">
    <!-- Toolbar -->
    <header id="toolbar">
      <div class="toolbar-left">
        <h1 class="app-title">DaylightLab</h1>
      </div>
      <div class="toolbar-center">
        <button id="btn-open" class="toolbar-btn" title="Open IFC file (O)">
          <span class="btn-icon">üìÇ</span> Open IFC
        </button>
        <div class="toolbar-divider"></div>
        <select id="room-select" class="toolbar-select" disabled>
          <option value="">Select Room...</option>
        </select>
        <button id="btn-calculate" class="toolbar-btn" disabled title="Calculate daylight (C)">
          <span class="btn-icon">‚òÄÔ∏è</span> Calculate
        </button>
        <button id="btn-calculate-all" class="toolbar-btn" disabled title="Calculate all rooms (A)">
          <span class="btn-icon">üìä</span> All Rooms
        </button>
        <div class="toolbar-divider"></div>
        <button id="btn-view-2d" class="toolbar-btn" disabled title="2D Plan View (2)">2D</button>
        <button id="btn-view-3d" class="toolbar-btn active" disabled title="3D View (3)">3D</button>
        <button id="btn-reset" class="toolbar-btn" disabled title="Reset View (R)">Reset</button>
        <div class="toolbar-divider"></div>
        <button id="btn-display-mode" class="toolbar-btn" disabled title="Toggle building visibility (V)">
          <span class="btn-icon">üè†</span> <span id="display-mode-text">Solid</span>
        </button>
        <div class="toolbar-divider"></div>
        <button id="btn-section" class="toolbar-btn" disabled title="Section cut (S)">
          <span class="btn-icon">‚úÇÔ∏è</span> Section
        </button>
        <button id="btn-sun-path" class="toolbar-btn" disabled title="Sun path (P)">
          <span class="btn-icon">üåÖ</span> Sun Path
        </button>
        <div class="toolbar-divider"></div>
        <button id="btn-compare" class="toolbar-btn" disabled title="Compare with another model">
          <span class="btn-icon">‚öñÔ∏è</span> Compare
        </button>
        <button id="btn-annotate" class="toolbar-btn" disabled title="Add annotation (N)">
          <span class="btn-icon">üìå</span> Annotate
        </button>
      </div>
      <div class="toolbar-right">
        <button id="btn-export-csv" class="toolbar-btn" disabled title="Export CSV data">üìÑ CSV</button>
        <button id="btn-export-pdf" class="toolbar-btn" disabled title="Export PDF report">üìë PDF</button>
        <div class="toolbar-divider"></div>
        <button id="btn-settings" class="toolbar-btn" title="Settings">‚öôÔ∏è</button>
        <button id="btn-export" class="toolbar-btn" disabled title="Export Image">üì∑</button>
      </div>
    </header>

    <!-- Main content area -->
    <main id="main-content">
      <!-- 3D Viewport -->
      <div id="viewport">
        <div id="drop-zone" class="active">
          <div class="drop-zone-content">
            <span class="drop-icon">üìÅ</span>
            <h2>Drop IFC file here</h2>
            <p>or click "Open IFC" to browse</p>
          </div>
        </div>
        <div id="loading-overlay" class="hidden">
          <div class="loading-content">
            <div class="spinner"></div>
            <p id="loading-text">Loading...</p>
            <div class="progress-bar">
              <div id="progress-fill" class="progress-fill"></div>
            </div>
          </div>
        </div>
        <canvas id="canvas"></canvas>

        <!-- Section Control Panel -->
        <div id="section-controls" class="viewport-controls hidden">
          <div class="control-header">
            <span>Section Cut</span>
            <button id="section-close" class="control-close">&times;</button>
          </div>
          <div class="control-body">
            <div class="control-row">
              <label>Axis:</label>
              <select id="section-axis">
                <option value="y" selected>Horizontal (Y)</option>
                <option value="x">Vertical X</option>
                <option value="z">Vertical Z</option>
              </select>
            </div>
            <div class="control-row">
              <label>Height: <span id="section-value">0.0</span>m</label>
              <input type="range" id="section-slider" min="0" max="100" value="50" step="1">
            </div>
          </div>
        </div>

        <!-- Sun Path Control Panel -->
        <div id="sunpath-controls" class="viewport-controls hidden" style="left: auto; right: 10px;">
          <div class="control-header">
            <span>‚òÄÔ∏è Sun Path</span>
            <button id="sunpath-close" class="control-close">&times;</button>
          </div>
          <div class="control-body">
            <div class="control-row">
              <label>Date:</label>
              <input type="date" id="sunpath-date" class="control-input">
            </div>
            <div class="control-row">
              <label>Quick select:</label>
              <div class="quick-dates">
                <button class="quick-date-btn" data-month="6" data-day="21">Summer</button>
                <button class="quick-date-btn" data-month="3" data-day="21">Equinox</button>
                <button class="quick-date-btn" data-month="12" data-day="21">Winter</button>
              </div>
            </div>
            <div class="control-row sunpath-info">
              <label>Location:</label>
              <span id="sunpath-location">51.5¬∞N, 0.1¬∞W</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Side panel -->
      <aside id="side-panel">
        <div class="panel-toggle" id="panel-toggle">‚óÄ</div>
        <div class="panel-content">
          <!-- Room Info Section -->
          <section class="panel-section" id="room-info-section">
            <h3 class="section-title">Room Information</h3>
            <div id="room-info" class="section-content">
              <p class="placeholder-text">Select a room to see details</p>
            </div>
          </section>

          <!-- Windows Section -->
          <section class="panel-section" id="windows-section">
            <h3 class="section-title">Windows</h3>
            <div id="windows-info" class="section-content">
              <p class="placeholder-text">Select a room to see windows</p>
            </div>
          </section>

          <!-- Results Section -->
          <section class="panel-section" id="results-section">
            <h3 class="section-title">Daylight Results</h3>
            <div id="results-info" class="section-content">
              <p class="placeholder-text">Calculate daylight to see results</p>
            </div>
          </section>

          <!-- Legend -->
          <section class="panel-section" id="legend-section">
            <h3 class="section-title">Legend</h3>
            <div id="legend" class="section-content">
              <div class="legend-scale">
                <div class="legend-gradient"></div>
                <div class="legend-labels">
                  <span>0%</span>
                  <span>1%</span>
                  <span>2%</span>
                  <span>5%</span>
                  <span>10%+</span>
                </div>
              </div>
              <div class="legend-thresholds">
                <div class="threshold-item poor">
                  <span class="threshold-color"></span>
                  <span>&lt; 2% - Poor</span>
                </div>
                <div class="threshold-item adequate">
                  <span class="threshold-color"></span>
                  <span>2-5% - Adequate</span>
                </div>
                <div class="threshold-item good">
                  <span class="threshold-color"></span>
                  <span>&gt; 5% - Well lit</span>
                </div>
              </div>
            </div>
          </section>
        </div>
      </aside>
    </main>

    <!-- Status bar -->
    <footer id="status-bar">
      <span id="status-text">Ready - Drop an IFC file to begin</span>
      <span id="status-coords"></span>
    </footer>
  </div>

  <!-- Hidden file inputs -->
  <input type="file" id="file-input" accept=".ifc" style="display: none;">
  <input type="file" id="compare-file-input" accept=".ifc" style="display: none;">

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close" id="settings-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-group">
          <h4>Grid Settings</h4>
          <label>
            Grid Spacing (m):
            <select id="setting-grid-spacing">
              <option value="0.25">0.25m (Fine)</option>
              <option value="0.5" selected>0.5m (Standard)</option>
              <option value="1.0">1.0m (Coarse)</option>
            </select>
          </label>
          <label>
            Work Plane Height (m):
            <input type="number" id="setting-work-plane" value="0.85" step="0.05" min="0" max="2">
          </label>
        </div>
        <div class="settings-group">
          <h4>Material Properties</h4>
          <label>
            Glazing Transmittance:
            <input type="number" id="setting-transmittance" value="0.7" step="0.05" min="0.1" max="0.95">
          </label>
          <label>
            Ceiling Reflectance:
            <input type="number" id="setting-ceiling-ref" value="0.8" step="0.05" min="0.1" max="0.95">
          </label>
          <label>
            Wall Reflectance:
            <input type="number" id="setting-wall-ref" value="0.5" step="0.05" min="0.1" max="0.95">
          </label>
          <label>
            Floor Reflectance:
            <input type="number" id="setting-floor-ref" value="0.2" step="0.05" min="0.1" max="0.95">
          </label>
        </div>
        <div class="settings-group">
          <h4>Location</h4>
          <label>
            Latitude:
            <input type="number" id="setting-latitude" value="51.5" step="0.1" min="-90" max="90">
          </label>
          <label>
            Longitude:
            <input type="number" id="setting-longitude" value="-0.1" step="0.1" min="-180" max="180">
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button id="settings-save" class="btn-primary">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- Batch Results Modal -->
  <div id="batch-results-modal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>Daylight Analysis Results</h2>
        <button class="modal-close" id="batch-results-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="batch-summary" id="batch-summary">
          <!-- Summary stats will be inserted here -->
        </div>
        <div class="batch-table-container">
          <table class="batch-results-table" id="batch-results-table">
            <thead>
              <tr>
                <th>Room</th>
                <th>Area (m¬≤)</th>
                <th>Windows</th>
                <th>Avg DF</th>
                <th>Min DF</th>
                <th>‚â•2% Area</th>
                <th>Compliance</th>
                <th>Recommendation</th>
              </tr>
            </thead>
            <tbody id="batch-results-body">
              <!-- Results will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button id="batch-export-csv" class="toolbar-btn">üìÑ Export CSV</button>
        <button id="batch-export-pdf" class="toolbar-btn">üìë Export PDF</button>
        <button id="batch-results-ok" class="btn-primary">Close</button>
      </div>
    </div>
  </div>

  <!-- Annotation Input Modal -->
  <div id="annotation-modal" class="modal hidden">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2>Add Annotation</h2>
        <button class="modal-close" id="annotation-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="annotation-text">Note:</label>
          <textarea id="annotation-text" rows="3" placeholder="Enter your annotation..."></textarea>
        </div>
        <div class="form-group">
          <label for="annotation-color">Color:</label>
          <select id="annotation-color">
            <option value="#ff4444">Red</option>
            <option value="#44ff44">Green</option>
            <option value="#4444ff">Blue</option>
            <option value="#ffaa00" selected>Orange</option>
            <option value="#aa44ff">Purple</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button id="annotation-cancel" class="toolbar-btn">Cancel</button>
        <button id="annotation-save" class="btn-primary">Add</button>
      </div>
    </div>
  </div>

  <!-- Comparison Results Modal -->
  <div id="comparison-modal" class="modal hidden">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>Model Comparison</h2>
        <button class="modal-close" id="comparison-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="comparison-header" id="comparison-header">
          <!-- Model names will be inserted here -->
        </div>
        <div class="comparison-summary" id="comparison-summary">
          <!-- Summary comparison will be inserted here -->
        </div>
        <div class="batch-table-container">
          <table class="batch-results-table" id="comparison-table">
            <thead>
              <tr>
                <th>Room</th>
                <th>Baseline Avg DF</th>
                <th>Comparison Avg DF</th>
                <th>Change</th>
                <th>Baseline Compliance</th>
                <th>Comparison Compliance</th>
              </tr>
            </thead>
            <tbody id="comparison-body">
              <!-- Comparison results will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button id="comparison-close-btn" class="btn-primary">Close</button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
